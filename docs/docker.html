<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-04-30T19:02:50.58906"><title>Table of Contents | Notes</title><script type="application/json" id="virtual-toc-data">[{"id":"docker","level":0,"title":"Docker","anchor":"#docker"},{"id":"i7ehp9o_835","level":0,"title":"概念\u0026安装","anchor":"#i7ehp9o_835"},{"id":"i7ehp9o_884","level":0,"title":"常用命令","anchor":"#i7ehp9o_884"},{"id":"i7ehp9o_1031","level":0,"title":"镜像原理","anchor":"#i7ehp9o_1031"},{"id":"docker","level":0,"title":"Docker容器数据卷","anchor":"#docker"},{"id":"notes-tool-dockerfile","level":0,"title":"notes.Tool.DockerFile","anchor":"#notes-tool-dockerfile"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Table of Contents | Notes"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Notes Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/docker.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Table of Contents | Notes"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/docker.html#webpage",
    "url": "writerside-documentation/docker.html",
    "name": "Table of Contents | Notes",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Notes Help"
}</script><!-- End Schema.org --></head><body data-id="Docker" data-main-title="Table of Contents" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Notes///java///notes///Tool"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Notes  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Docker" id="Docker.md">Table of Contents</h1><ul class="list _bullet" id="i7ehp9o_780"><li class="list__item" id="i7ehp9o_781"><p><span id="i7ehp9o_782">Docker</span></p></li><li class="list__item" id="i7ehp9o_783"><p><span id="i7ehp9o_784">Docker</span></p><ul class="list _bullet" id="i7ehp9o_785"><li class="list__item" id="i7ehp9o_786"><p><span id="i7ehp9o_787">概念&amp;安装</span></p><ul class="list _bullet" id="i7ehp9o_788"><li class="list__item" id="i7ehp9o_789"><p><span id="i7ehp9o_790">改源</span></p></li><li class="list__item" id="i7ehp9o_791"><p><span id="i7ehp9o_792">优缺点</span></p></li></ul></li><li class="list__item" id="i7ehp9o_793"><p><span id="i7ehp9o_794">常用命令</span></p><ul class="list _bullet" id="i7ehp9o_795"><li class="list__item" id="i7ehp9o_796"><p><span id="i7ehp9o_797">帮助命令</span></p></li><li class="list__item" id="i7ehp9o_798"><p><span id="i7ehp9o_799">镜像命令</span></p></li><li class="list__item" id="i7ehp9o_800"><p><span id="i7ehp9o_801">容器命令</span></p><ul class="list _bullet" id="i7ehp9o_802"><li class="list__item" id="i7ehp9o_803"><p><span id="i7ehp9o_804">新建并启动容器</span></p></li><li class="list__item" id="i7ehp9o_805"><p><span id="i7ehp9o_806">列出当前所有正住运行的容器</span></p></li><li class="list__item" id="i7ehp9o_807"><p><span id="i7ehp9o_808">操作容器</span></p></li></ul></li><li class="list__item" id="i7ehp9o_809"><p><span id="i7ehp9o_810">重要命令</span></p></li></ul></li><li class="list__item" id="i7ehp9o_811"><p><span id="i7ehp9o_812">镜像原理</span></p></li><li class="list__item" id="i7ehp9o_813"><p><span id="i7ehp9o_814">Docker容器数据卷</span></p></li><li class="list__item" id="i7ehp9o_815"><p><span id="i7ehp9o_816">notes.Tool.DockerFile</span></p><ul class="list _bullet" id="i7ehp9o_817"><li class="list__item" id="i7ehp9o_818"><p><span id="i7ehp9o_819">直接命令添加</span></p></li><li class="list__item" id="i7ehp9o_820"><p><span id="i7ehp9o_821">DockerFile添加</span></p></li><li class="list__item" id="i7ehp9o_822"><p><span id="i7ehp9o_823">数据卷容器</span></p></li><li class="list__item" id="i7ehp9o_824"><p><span id="i7ehp9o_825">notes.Tool.DockerFile 规范</span></p></li><li class="list__item" id="i7ehp9o_826"><p><span id="i7ehp9o_827">DockerFile体系结构(保留字指令)</span></p><ul class="list _bullet" id="i7ehp9o_828"><li class="list__item" id="i7ehp9o_829"><p><span id="i7ehp9o_830">遇到的问题</span></p></li></ul></li><li class="list__item" id="i7ehp9o_831"><p><span id="i7ehp9o_832">push</span></p></li></ul></li></ul></li></ul><section class="chapter"><h2 id="docker" data-toc="docker">Docker</h2><ul class="list _bullet" id="i7ehp9o_833"><li class="list__item" id="i7ehp9o_834"><p>CentOS6.5及以上</p></li></ul></section><section class="chapter"><h2 id="i7ehp9o_835" data-toc="i7ehp9o_835">概念&amp;安装</h2><ul class="list _bullet" id="i7ehp9o_836"><li class="list__item" id="i7ehp9o_837"><p id="i7ehp9o_838">镜像 一个只读的模板,创建Docker容器</p></li><li class="list__item" id="i7ehp9o_839"><p id="i7ehp9o_840">容器 利用镜像创建的实例</p></li><li class="list__item" id="i7ehp9o_841"><p id="i7ehp9o_842">仓库 集中存放镜像文件的场所</p></li><li class="list__item" id="i7ehp9o_843"><p id="i7ehp9o_844">一般下载</p></li></ul><div class="code-block" data-lang="bash">
$ sudo yum install -y yum-utils

$ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
</div><div class="code-block" data-lang="bash">
$ sudo yum-config-manager --enable docker-ce-nightly
</div><div class="code-block" data-lang="bash">
$ sudo yum-config-manager --enable docker-ce-test

</div><div class="code-block" data-lang="bash">
$ sudo yum-config-manager --disable docker-ce-nightly
</div><div class="code-block" data-lang="bash">
$ sudo yum install docker-ce docker-ce-cli containerd.io
</div><ul class="list _bullet" id="i7ehp9o_850"><li class="list__item" id="i7ehp9o_851"><p>启动</p></li></ul><div class="code-block" data-lang="bash">
$ sudo systemctl start docker
</div><ul class="list _bullet" id="i7ehp9o_853"><li class="list__item" id="i7ehp9o_854"><p>HelloWorld</p></li></ul><div class="code-block" data-lang="bash">
$ sudo docker run hello-world
</div><section class="chapter"><h3 id="i7ehp9o_856" data-toc="i7ehp9o_856">改源</h3><div class="code-block" data-lang="bash">
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://xxxxxxx.mirror.aliyuncs.com&quot;]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker

</div></section><section class="chapter"><h3 id="i7ehp9o_858" data-toc="i7ehp9o_858">优缺点</h3><div class="table-wrapper"><table class="wide" id="i7ehp9o_859"><thead><tr class="ijRowHead" id="i7ehp9o_860"><th id="i7ehp9o_861"></th><th id="i7ehp9o_862"><p>Docker容器</p></th><th id="i7ehp9o_863"><p>虚拟机(VM)</p></th></tr></thead><tbody><tr id="i7ehp9o_864"><td id="i7ehp9o_865"><p>操作系统</p></td><td id="i7ehp9o_866"><p>与宿主机共享OS</p></td><td id="i7ehp9o_867"><p>宿主机OS上运行虚拟机OS</p></td></tr><tr id="i7ehp9o_868"><td id="i7ehp9o_869"><p>存储大小</p></td><td id="i7ehp9o_870"><p>镜像小,便于存储与传输</p></td><td id="i7ehp9o_871"><p>镜像庞大(vmdk,vdi等)</p></td></tr><tr id="i7ehp9o_872"><td id="i7ehp9o_873"><p>运行性能</p></td><td id="i7ehp9o_874"><p>几乎无额外性能损失</p></td><td id="i7ehp9o_875"><p>操作系统额外的CPU,内存消耗</p></td></tr><tr id="i7ehp9o_876"><td id="i7ehp9o_877"><p>移植性</p></td><td id="i7ehp9o_878"><p>灵活,轻便,适应于Linux</p></td><td id="i7ehp9o_879"><p>面向硬件运维者</p></td></tr><tr id="i7ehp9o_880"><td id="i7ehp9o_881"><p>部署速度</p></td><td id="i7ehp9o_882"><p>快速,秒级</p></td><td id="i7ehp9o_883"><p>较慢,10s以上</p></td></tr></tbody></table></div></section></section><section class="chapter"><h2 id="i7ehp9o_884" data-toc="i7ehp9o_884">常用命令</h2><section class="chapter"><h3 id="i7ehp9o_885" data-toc="i7ehp9o_885">帮助命令</h3><div class="code-block" data-lang="bash">
docker help
docker info
docker version
</div></section><section class="chapter"><h3 id="i7ehp9o_887" data-toc="i7ehp9o_887">镜像命令</h3><div class="code-block" data-lang="bash">
docker images
</div><ul class="list _bullet" id="i7ehp9o_889"><li class="list__item" id="i7ehp9o_890"><p>当前主机上的镜像</p></li><li class="list__item" id="i7ehp9o_891"><p><code class="code" id="i7ehp9o_892">-a</code>全部镜像(含中间镜像层)</p></li><li class="list__item" id="i7ehp9o_893"><p><code class="code" id="i7ehp9o_894">-q</code>imageId</p></li><li class="list__item" id="i7ehp9o_895"><p><code class="code" id="i7ehp9o_896">--digests</code> 详细信息</p></li><li class="list__item" id="i7ehp9o_897"><p><code class="code" id="i7ehp9o_898">--no-trunc</code> 显示完整的镜像信息</p></li></ul><div class="code-block" data-lang="bash">
docker search xxx
</div><ul class="list _bullet" id="i7ehp9o_900"><li class="list__item" id="i7ehp9o_901"><p>查询镜像</p></li><li class="list__item" id="i7ehp9o_902"><p><code class="code" id="i7ehp9o_903">-s [nums]</code>点赞数大于nums的</p></li></ul><div class="code-block" data-lang="bash">
docker pull xxx:[titile:默认不加]
docker rmi xxx
</div><ul class="list _bullet" id="i7ehp9o_905"><li class="list__item" id="i7ehp9o_906"><p><code class="code" id="i7ehp9o_907">pull</code> 拉取镜像</p></li><li class="list__item" id="i7ehp9o_908"><p><code class="code" id="i7ehp9o_909">rmi</code></p><ul class="list _bullet" id="i7ehp9o_910"><li class="list__item" id="i7ehp9o_911"><p>删除镜像,要保证镜像以关闭</p></li><li class="list__item" id="i7ehp9o_912"><p><code class="code" id="i7ehp9o_913">-f</code>强制删除</p></li><li class="list__item" id="i7ehp9o_914"><p>可多个删除</p></li><li class="list__item" id="i7ehp9o_915"><p>删除全部 <code class="code" id="i7ehp9o_916">docker rmi -f $(docker images -qa</code></p></li></ul></li></ul></section><section class="chapter"><h3 id="i7ehp9o_917" data-toc="i7ehp9o_917">容器命令</h3><p id="i7ehp9o_918">以windows的vmare中的centos中的centos为例</p><section class="chapter"><h4 id="i7ehp9o_919" data-toc="i7ehp9o_919">新建并启动容器</h4><div class="code-block" data-lang="bash">
docker run[OPTIONS] IMAGE [COMMAND]{ARG...}
</div><ul class="list _bullet" id="i7ehp9o_921"><li class="list__item" id="i7ehp9o_922"><p><code class="code" id="i7ehp9o_923">--name</code> 指定NAME</p></li><li class="list__item" id="i7ehp9o_924"><p><code class="code" id="i7ehp9o_925">-d</code> 后台运行容器,并返回容器ID,也即启动守护式容器</p></li><li class="list__item" id="i7ehp9o_926"><p><code class="code" id="i7ehp9o_927">-i</code>以交互模式运行容器,通常与-t同时使用</p></li><li class="list__item" id="i7ehp9o_928"><p><code class="code" id="i7ehp9o_929">-t</code>为容器重新分配一个伪输入终端</p></li></ul></section><section class="chapter"><h4 id="i7ehp9o_930" data-toc="i7ehp9o_930">列出当前所有正住运行的容器</h4><div class="code-block" data-lang="bash">
docker ps [OPTIONS]
</div><ul class="list _bullet" id="i7ehp9o_932"><li class="list__item" id="i7ehp9o_933"><p><code class="code" id="i7ehp9o_934">-q</code> 静默模式,只显示容器编号</p></li><li class="list__item" id="i7ehp9o_935"><p><code class="code" id="i7ehp9o_936">-l</code> 显示最近创建过的容器</p></li><li class="list__item" id="i7ehp9o_937"><p><code class="code" id="i7ehp9o_938">-a</code> 列出当前所有正在运行的容器+历史运行过的</p></li><li class="list__item" id="i7ehp9o_939"><p><code class="code" id="i7ehp9o_940">-n</code> 显示最近n个创建的容器</p></li><li class="list__item" id="i7ehp9o_941"><p><code class="code" id="i7ehp9o_942">--no-trunc</code> 不截断输出</p></li></ul></section><section class="chapter"><h4 id="i7ehp9o_943" data-toc="i7ehp9o_943">操作容器</h4><ul class="list _bullet" id="i7ehp9o_944"><li class="list__item" id="i7ehp9o_945"><p id="i7ehp9o_946">退出容器</p><ol class="list _decimal" id="i7ehp9o_947" type="1"><li class="list__item" id="i7ehp9o_948"><p><code class="code" id="i7ehp9o_949">exit</code>关闭容器并退出</p></li><li class="list__item" id="i7ehp9o_950"><p><code class="code" id="i7ehp9o_951">Ctrl</code>+<code class="code" id="i7ehp9o_952">p</code>+<code class="code" id="i7ehp9o_953">q</code> 退出不关闭</p></li></ol></li><li class="list__item" id="i7ehp9o_954"><p id="i7ehp9o_955">启动容器</p><ul class="list _bullet" id="i7ehp9o_956"><li class="list__item" id="i7ehp9o_957"><p><code class="code" id="i7ehp9o_958">docker start xxx</code> id或容器名</p></li></ul></li><li class="list__item" id="i7ehp9o_959"><p id="i7ehp9o_960">重启容器</p><ul class="list _bullet" id="i7ehp9o_961"><li class="list__item" id="i7ehp9o_962"><p><code class="code" id="i7ehp9o_963">docker restart xxx</code>id或容器名</p></li></ul></li><li class="list__item" id="i7ehp9o_964"><p id="i7ehp9o_965">停止</p><ul class="list _bullet" id="i7ehp9o_966"><li class="list__item" id="i7ehp9o_967"><p><code class="code" id="i7ehp9o_968">docker stop xxx</code> 停止容器</p></li><li class="list__item" id="i7ehp9o_969"><p><code class="code" id="i7ehp9o_970">docker kill xxx</code> 强制停止容器</p></li></ul></li><li class="list__item" id="i7ehp9o_971"><p id="i7ehp9o_972">删除容器 <code class="code" id="i7ehp9o_973">docker rm xxx</code>没有i::</p><ul class="list _bullet" id="i7ehp9o_974"><li class="list__item" id="i7ehp9o_975"><p><code class="code" id="i7ehp9o_976">-f</code> 强制删除</p></li><li class="list__item" id="i7ehp9o_977"><p>删除多个容器 </p><ul class="list _bullet" id="i7ehp9o_978"><li class="list__item" id="i7ehp9o_979"><p><code class="code" id="i7ehp9o_980">docker rm -f $(docker ps -a -q)</code></p></li><li class="list__item" id="i7ehp9o_981"><p><code class="code" id="i7ehp9o_982">docker ps -a -q|xargs docker rm</code></p></li></ul></li></ul></li></ul></section></section><section class="chapter"><h3 id="i7ehp9o_983" data-toc="i7ehp9o_983">重要命令</h3><ol class="list _decimal" id="i7ehp9o_984" type="1"><li class="list__item" id="i7ehp9o_985"><p id="i7ehp9o_986">启动</p><ul class="list _bullet" id="i7ehp9o_987"><li class="list__item" id="i7ehp9o_988"><p><code class="code" id="i7ehp9o_989">docker run -d centos</code> 后台启动centos,但会被瞬间退出 </p><ul class="list _bullet" id="i7ehp9o_990"><li class="list__item" id="i7ehp9o_991"><p>docker 容器后台运行,必须要有前台进程</p></li><li class="list__item" id="i7ehp9o_992"><p>容器运行的命令如果不是那些一直挂起的命令(top,tail),会自动退出</p></li></ul></li></ul></li><li class="list__item" id="i7ehp9o_993"><p id="i7ehp9o_994">查看容器日志</p><ul class="list _bullet" id="i7ehp9o_995"><li class="list__item" id="i7ehp9o_996"><p><code class="code" id="i7ehp9o_997">docker logs -f -t --tail n xxx</code></p><ul class="list _bullet" id="i7ehp9o_998"><li class="list__item" id="i7ehp9o_999"><p><code class="code" id="i7ehp9o_1000">-t</code>是加入时间戳</p></li><li class="list__item" id="i7ehp9o_1001"><p><code class="code" id="i7ehp9o_1002">-f</code> 跟随最新的日志打印</p></li><li class="list__item" id="i7ehp9o_1003"><p><code class="code" id="i7ehp9o_1004">--tail</code> 数字显示最后多少条</p></li></ul></li></ul></li><li class="list__item" id="i7ehp9o_1005"><p id="i7ehp9o_1006">查看容器内运行的进程</p><ul class="list _bullet" id="i7ehp9o_1007"><li class="list__item" id="i7ehp9o_1008"><p><code class="code" id="i7ehp9o_1009">docker top xxx</code>相当于linux的top</p></li></ul></li><li class="list__item" id="i7ehp9o_1010"><p id="i7ehp9o_1011">查看容器内部细节</p><ul class="list _bullet" id="i7ehp9o_1012"><li class="list__item" id="i7ehp9o_1013"><p><code class="code" id="i7ehp9o_1014">docker inspect 容器ID</code></p></li></ul></li><li class="list__item" id="i7ehp9o_1015"><p id="i7ehp9o_1016">进入正在运行的容器并以命令行交互</p><ul class="list _bullet" id="i7ehp9o_1017"><li class="list__item" id="i7ehp9o_1018"><p><code class="code" id="i7ehp9o_1019">docker exec -it 容器ID bashShell</code></p><ul class="list _bullet" id="i7ehp9o_1020"><li class="list__item" id="i7ehp9o_1021"><p>是在容器中打开新的终端,并且可以启动新的进程</p></li></ul></li><li class="list__item" id="i7ehp9o_1022"><p>重新进入<code class="code" id="i7ehp9o_1023">docker attach 容器ID</code></p><ul class="list _bullet" id="i7ehp9o_1024"><li class="list__item" id="i7ehp9o_1025"><p>直接进入容器启动命令的终端,不会启动新的进程</p></li></ul></li></ul></li><li class="list__item" id="i7ehp9o_1026"><p id="i7ehp9o_1027">从容器内拷贝文件到宿主机</p><ul class="list _bullet" id="i7ehp9o_1028"><li class="list__item" id="i7ehp9o_1029"><p><code class="code" id="i7ehp9o_1030">docker cp 容器ID:路径 宿主机路径:</code></p></li></ul></li></ol></section></section><section class="chapter"><h2 id="i7ehp9o_1031" data-toc="i7ehp9o_1031">镜像原理</h2><ul class="list _bullet" id="i7ehp9o_1032"><li class="list__item" id="i7ehp9o_1033"><p id="i7ehp9o_1034">是什么: 1.UnionFS(联合文件系统) bootfs rootfs</p><ol class="list _decimal" id="i7ehp9o_1035" type="1" start="2"><li class="list__item" id="i7ehp9o_1036"><p>Docker镜像加载原理</p></li><li class="list__item" id="i7ehp9o_1037"><p>分层的镜像</p></li></ol></li><li class="list__item" id="i7ehp9o_1038"><p id="i7ehp9o_1039">特点</p><ol class="list _decimal" id="i7ehp9o_1040" type="1"><li class="list__item" id="i7ehp9o_1041"><p>Docker镜像都是只读的</p></li><li class="list__item" id="i7ehp9o_1042"><p>当容器启动时,一个新的可写层被加载到镜像的顶部.这一层通常被称作&quot;容器层&quot;,&quot;容器层&quot;之下的都叫镜像层</p></li></ol></li><li class="list__item" id="i7ehp9o_1043"><p id="i7ehp9o_1044">tomcat</p><ul class="list _bullet" id="i7ehp9o_1045"><li class="list__item" id="i7ehp9o_1046"><p><code class="code" id="i7ehp9o_1047">docker run -it -p 8888:8080 tomcat</code> 端口映射</p></li></ul></li><li class="list__item" id="i7ehp9o_1048"><p id="i7ehp9o_1049">提交commit</p><ul class="list _bullet" id="i7ehp9o_1050"><li class="list__item" id="i7ehp9o_1051"><p><code class="code" id="i7ehp9o_1052">docker commit -m=&quot;提交的信息&quot; -a=&quot;作者&quot; 容器ID 要创建的镜像名:[标签名]</code></p></li></ul></li></ul></section><section class="chapter"><h2 id="docker" data-toc="docker">Docker容器数据卷</h2><ul class="list _bullet" id="i7ehp9o_1053"><li class="list__item" id="i7ehp9o_1054"><p>是什么 </p><ul class="list _bullet" id="i7ehp9o_1055"><li class="list__item" id="i7ehp9o_1056"><p>保存数据 类似docker cp</p></li></ul></li><li class="list__item" id="i7ehp9o_1057"><p>特点 </p><ol class="list _decimal" id="i7ehp9o_1058" type="1"><li class="list__item" id="i7ehp9o_1059"><p>数据卷可在容器之间共享或重用数据</p></li><li class="list__item" id="i7ehp9o_1060"><p>卷中的更改可以直接生效</p></li><li class="list__item" id="i7ehp9o_1061"><p>数据卷中的更改不会包含在镜像的更新中</p></li><li class="list__item" id="i7ehp9o_1062"><p>数据卷的生命周期一直持续到没有容器继续使用它为止</p></li></ol></li><li class="list__item" id="i7ehp9o_1063"><p>数据卷 容器内添加 </p><ul class="list _bullet" id="i7ehp9o_1064"><li class="list__item" id="i7ehp9o_1065"><p>直接命令添加 </p><ul class="list _bullet" id="i7ehp9o_1066"><li class="list__item" id="i7ehp9o_1067"><p><code class="code" id="i7ehp9o_1068">docker run -it -v /宿主机绝对路径目录:/容器目录 镜像名</code> 如果目录不存在,会创建目录</p></li><li class="list__item" id="i7ehp9o_1069"><p><code class="code" id="i7ehp9o_1070">docker inspect</code> 查看详细信息,看是否挂载成功</p></li><li class="list__item" id="i7ehp9o_1071"><p><code class="code" id="i7ehp9o_1072">docker run -it -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</code> 只读</p></li><li class="list__item" id="i7ehp9o_1073"><p><code class="code" id="i7ehp9o_1074">--privileged=true</code> 若没有权限加此参数</p></li></ul></li><li class="list__item" id="i7ehp9o_1075"><p>dockerFile添加 备注:</p></li></ul></li></ul></section><section class="chapter"><h2 id="notes-tool-dockerfile" data-toc="notes-tool-dockerfile">notes.Tool.DockerFile</h2><section class="chapter"><h3 id="i7ehp9o_1076" data-toc="i7ehp9o_1076">直接命令添加</h3></section><section class="chapter"><h3 id="dockerfile" data-toc="dockerfile">DockerFile添加</h3><ol class="list _decimal" id="i7ehp9o_1077" type="1"><li class="list__item" id="i7ehp9o_1078"><p>根目录下新建mydocker并进入</p></li><li class="list__item" id="i7ehp9o_1079"><p>可在Dockerfile中使用VOLUME指令来给镜像添加一个或多个数据卷</p></li><li class="list__item" id="i7ehp9o_1080"><p>File构建</p></li><li class="list__item" id="i7ehp9o_1081"><p>build后生成镜像</p></li><li class="list__item" id="i7ehp9o_1082"><p>run容器</p></li></ol></section><section class="chapter"><h3 id="i7ehp9o_1083" data-toc="i7ehp9o_1083">数据卷容器</h3><p id="i7ehp9o_1084">命名的容器挂载数据卷,其他容器通过挂载这个(父容器)实现数据共享,挂在数据卷的容器,称之为数据卷容器</p><ul class="list _bullet" id="i7ehp9o_1085"><li class="list__item" id="i7ehp9o_1086"><p>容器间传递共享(--volumes-from) </p><ul class="list _bullet" id="i7ehp9o_1087"><li class="list__item" id="i7ehp9o_1088"><p>先启动一个父容器dk01</p></li><li class="list__item" id="i7ehp9o_1089"><p>dk02/dk03 (集成)共享dk01 dk01</p></li></ul></li></ul><div class="code-block" data-lang="json">
&quot;Mounts&quot;: [
           {
               &quot;Type&quot;: &quot;volume&quot;,
               &quot;Name&quot;: &quot;bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4&quot;,
               &quot;Source&quot;: &quot;/var/lib/docker/volumes/bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4/_data&quot;,
               &quot;Destination&quot;: &quot;/dataVolumeContainer2&quot;,
               &quot;Driver&quot;: &quot;local&quot;,
               &quot;Mode&quot;: &quot;&quot;,
               &quot;RW&quot;: true,
               &quot;Propagation&quot;: &quot;&quot;
           },
           {
               &quot;Type&quot;: &quot;volume&quot;,
               &quot;Name&quot;: &quot;e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb&quot;,
               &quot;Source&quot;: &quot;/var/lib/docker/volumes/e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb/_data&quot;,
               &quot;Destination&quot;: &quot;/dataVolumeContainer1&quot;,
               &quot;Driver&quot;: &quot;local&quot;,
               &quot;Mode&quot;: &quot;&quot;,
               &quot;RW&quot;: true,
               &quot;Propagation&quot;: &quot;&quot;
           }
       ],

</div><p id="i7ehp9o_1091">dk02</p><div class="code-block" data-lang="json">
 &quot;Mounts&quot;: [
            {
                &quot;Type&quot;: &quot;volume&quot;,
                &quot;Name&quot;: &quot;e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb&quot;,
                &quot;Source&quot;: &quot;/var/lib/docker/volumes/e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb/_data&quot;,
                &quot;Destination&quot;: &quot;/dataVolumeContainer1&quot;,
                &quot;Driver&quot;: &quot;local&quot;,
                &quot;Mode&quot;: &quot;&quot;,
                &quot;RW&quot;: true,
                &quot;Propagation&quot;: &quot;&quot;
            },
            {
                &quot;Type&quot;: &quot;volume&quot;,
                &quot;Name&quot;: &quot;bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4&quot;,
                &quot;Source&quot;: &quot;/var/lib/docker/volumes/bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4/_data&quot;,
                &quot;Destination&quot;: &quot;/dataVolumeContainer2&quot;,
                &quot;Driver&quot;: &quot;local&quot;,
                &quot;Mode&quot;: &quot;&quot;,
                &quot;RW&quot;: true,
                &quot;Propagation&quot;: &quot;&quot;
            }
        ],

</div><p id="i7ehp9o_1093">挂载对应一致,实现共享数据</p></section><section class="chapter"><h3 id="notes-tool-dockerfile" data-toc="notes-tool-dockerfile">notes.Tool.DockerFile 规范</h3><ol class="list _decimal" id="i7ehp9o_1094" type="1"><li class="list__item" id="i7ehp9o_1095"><p>每条保留字指令都必须为大写字母且后面至少跟随一个参数</p></li><li class="list__item" id="i7ehp9o_1096"><p>指令按照从上到下,顺序执行</p></li><li class="list__item" id="i7ehp9o_1097"><p><code class="code" id="i7ehp9o_1098">#</code>表示注释</p></li><li class="list__item" id="i7ehp9o_1099"><p>每条指令都会创建一个新的镜像层,并对镜像进行提交</p></li></ol><ul class="list _bullet" id="i7ehp9o_1100"><li class="list__item" id="i7ehp9o_1101"><p>总结: </p><ol class="list _decimal" id="i7ehp9o_1102" type="1"><li class="list__item" id="i7ehp9o_1103"><p>Dockerfile,需要定一个Dockerfile,Dockerfile定义了进程需要的一切东西,Dockerfile涉及的内容包括执行代码或是文件, 环境,变量,依赖包,运行时环境,动态链接库,操作系统的发行版,服务进程和内核(当应用进程需要和系统服务和内核进程打交道, 这时需思考如何设计namespace的控制权限)等等</p></li><li class="list__item" id="i7ehp9o_1104"><p>Docker 镜像,在用Dockerfile定义一个文件之后, <code class="code" id="i7ehp9o_1105">docker build</code>会产生一个Docker镜像,当运行Docker镜像时,会真正开始提供服务</p></li><li class="list__item" id="i7ehp9o_1106"><p>Docker容器,容器是直接提供服务的</p></li><li class="list__item" id="i7ehp9o_1107"><p>例: <code class="code" id="i7ehp9o_1108">docker build -f ./DockerFileTest2 -t test/centos:1.4 .</code></p></li></ol></li></ul></section><section class="chapter"><h3 id="dockerfile" data-toc="dockerfile">DockerFile体系结构(保留字指令)</h3><ul class="list _bullet" id="i7ehp9o_1109"><li class="list__item" id="i7ehp9o_1110"><p><code class="code" id="i7ehp9o_1111">From</code> 基础镜像,当前新镜像是基于哪个镜像的</p></li><li class="list__item" id="i7ehp9o_1112"><p><code class="code" id="i7ehp9o_1113">MAINTAINER</code> 镜像维护者的姓名和邮箱地址</p></li><li class="list__item" id="i7ehp9o_1114"><p><code class="code" id="i7ehp9o_1115">RUN</code> 容器构建时需要运行的命令</p></li><li class="list__item" id="i7ehp9o_1116"><p><code class="code" id="i7ehp9o_1117">EXPOSE</code> 当前容器对外暴露出的端口</p></li><li class="list__item" id="i7ehp9o_1118"><p><code class="code" id="i7ehp9o_1119">WORKDIR</code> 指定在创建容器后,终端默认登录的进来工作目录,一个落脚点</p></li><li class="list__item" id="i7ehp9o_1120"><p><code class="code" id="i7ehp9o_1121">ENV</code>用来在构建镜像过程中设置环境变量</p></li><li class="list__item" id="i7ehp9o_1122"><p><code class="code" id="i7ehp9o_1123">ADD</code>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</p></li><li class="list__item" id="i7ehp9o_1124"><p><code class="code" id="i7ehp9o_1125">COPY</code></p><ul class="list _bullet" id="i7ehp9o_1126"><li class="list__item" id="i7ehp9o_1127"><p>类似<code class="code" id="i7ehp9o_1128">ADD</code> ,拷贝文件和目录到镜像中</p></li><li class="list__item" id="i7ehp9o_1129"><p>将从构建上下文目录中&lt;路径源&gt;的文件/目录复制到新的一层的镜像内&lt;目标路径&gt;位置</p></li></ul></li><li class="list__item" id="i7ehp9o_1130"><p><code class="code" id="i7ehp9o_1131">VOLUME</code> 容器数据卷,用于数据保存和持久化工作</p></li><li class="list__item" id="i7ehp9o_1132"><p><code class="code" id="i7ehp9o_1133">CMD</code></p><ul class="list _bullet" id="i7ehp9o_1134"><li class="list__item" id="i7ehp9o_1135"><p>指定一个容器启动时要运行的命令</p></li><li class="list__item" id="i7ehp9o_1136"><p>Dockerfile中可以有多个CMD命令,但只有最后一个生效,CMD会被<code class="code" id="i7ehp9o_1137">docker run</code>之后的参数替换</p></li></ul></li><li class="list__item" id="i7ehp9o_1138"><p><code class="code" id="i7ehp9o_1139">ENTRYPOINT</code></p><ul class="list _bullet" id="i7ehp9o_1140"><li class="list__item" id="i7ehp9o_1141"><p>指定一个容器启动时要运行的命令</p></li><li class="list__item" id="i7ehp9o_1142"><p><code class="code" id="i7ehp9o_1143">ENTRYPOINT</code> 的目的和<code class="code" id="i7ehp9o_1144">CMD</code>一样,都是在指定容器启动程序及参数</p></li></ul></li><li class="list__item" id="i7ehp9o_1145"><p><code class="code" id="i7ehp9o_1146">ONBUILD</code> 当构建一个被继承的Dockerfile时运行命令,父镜像在被子继承后父镜像<code class="code" id="i7ehp9o_1147">onbuild</code>被触发</p></li></ul><section class="chapter"><h4 id="i7ehp9o_1148" data-toc="i7ehp9o_1148">遇到的问题</h4><ul class="list _bullet" id="i7ehp9o_1149"><li class="list__item" id="i7ehp9o_1150"><p>WARNING: IPv4 forwarding is disabled. Networking will not work. 导致<code class="code" id="i7ehp9o_1151">RUN yum -y install xxx</code> 不可用 </p><ul class="list _bullet" id="i7ehp9o_1152"><li class="list__item" id="i7ehp9o_1153"><p>原因,docker 容器ip地址未分配</p></li><li class="list__item" id="i7ehp9o_1154"><p>解决措施: 复用宿主机ip </p><ul class="list _bullet" id="i7ehp9o_1155"><li class="list__item" id="i7ehp9o_1156"><p>写入宿主机 </p><ul class="list _bullet" id="i7ehp9o_1157"><li class="list__item" id="i7ehp9o_1158"><p><code class="code" id="i7ehp9o_1159">echo &quot;net.ipv4.ip_forward=1&quot; &gt;&gt;/usr/lib/sysctl.d/00-system.conf</code></p></li></ul></li><li class="list__item" id="i7ehp9o_1160"><p>重启宿主机network和docker </p><ul class="list _bullet" id="i7ehp9o_1161"><li class="list__item" id="i7ehp9o_1162"><p><code class="code" id="i7ehp9o_1163">systemctl restart network</code></p></li><li class="list__item" id="i7ehp9o_1164"><p><code class="code" id="i7ehp9o_1165">systemctl restart docker</code></p></li></ul></li></ul></li></ul></li></ul></section></section><section class="chapter"><h3 id="push" data-toc="push">push</h3><div class="code-block" data-lang="bash">
$ sudo docker login --username=chinaanhlaidh registry.cn-hangzhou.aliyuncs.com
$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/anhlaidh/mysentos:[镜像版本号]
$ sudo docker push registry.cn-hangzhou.aliyuncs.com/anhlaidh/mysentos:[镜像版本号]
</div><div class="code-block" data-lang="bash">
$ sudo docker tag e575ef00df05 registry.cn-hangzhou.aliyuncs.com/anhlaidh/mysentos:1.0.1
</div></section></section><div class="last-modified">Last modified: 30 四月 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="git.html" class="navigation-links__next">Git</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.js"></script></body></html>